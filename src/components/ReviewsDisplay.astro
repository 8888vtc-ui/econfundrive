---
import { featuredReviews, aggregateRating } from '../data/reviews.ts';

interface Props {
  showAll?: boolean;
  limit?: number;
}

const { showAll = false, limit = 6 } = Astro.props;
const reviewsToShow = showAll ? featuredReviews : featuredReviews.slice(0, limit);
---

<section class="reviews-section" aria-label="Avis clients">
  <div class="container">
    <div class="reviews-header">
      <h2 class="reviews-title">Avis Clients</h2>
      <div class="rating-badge">
        <div class="rating-stars">★★★★★</div>
        <div class="rating-info">
          <span class="rating-value">{aggregateRating.ratingValue}</span>
          <span class="rating-count">/ {aggregateRating.reviewCount} avis</span>
        </div>
        <a 
          href="https://www.trustindex.io/reviews/ecofundrive.com" 
          target="_blank" 
          rel="noopener noreferrer" 
          class="trustindex-badge"
          aria-label="Voir tous les avis sur Trustindex"
        >
          Vérifié Trustindex
        </a>
      </div>
    </div>

    <div class="reviews-grid">
      {reviewsToShow.map((review) => (
        <article class="review-card" itemscope itemtype="https://schema.org/Review">
          <div class="review-rating" itemprop="reviewRating" itemscope itemtype="https://schema.org/Rating">
            <span class="stars">{'★'.repeat(review.rating)}</span>
            <meta itemprop="ratingValue" content={review.rating.toString()} />
            <meta itemprop="bestRating" content="5" />
          </div>
          <div class="review-body" itemprop="reviewBody">
            <p>"{review.reviewBody}"</p>
          </div>
          <div class="review-footer">
            <div class="review-author" itemprop="author" itemscope itemtype="https://schema.org/Person">
              <strong itemprop="name">{review.author}</strong>
            </div>
            <time class="review-date" datetime={review.datePublished} itemprop="datePublished">
              {new Date(review.datePublished).toLocaleDateString('fr-FR', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
              })}
            </time>
          </div>
        </article>
      ))}
    </div>

    <div class="reviews-cta">
      <a href="/avis-clients" class="btn btn-secondary">Voir tous les avis</a>
      <a 
        href="https://www.trustindex.io/reviews/ecofundrive.com" 
        target="_blank" 
        rel="noopener noreferrer" 
        class="btn btn-primary"
      >
        Laisser un avis
      </a>
    </div>
  </div>
</section>


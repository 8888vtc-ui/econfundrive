---
import Logo from './Logo.astro';

interface Props {
  currentPage?: string;
}

const { currentPage = "" } = Astro.props;
---

<header class="site-header">
  <div class="container navbar">
    <div class="nav-brand">
      <a href="/" class="nav-brand-link" aria-label="ECOFUNDRIVE - Retour à l'accueil">
        <Logo />
      </a>
    </div>
    
    <!-- Menu Desktop -->
    <nav class="nav-links-desktop" id="nav-menu-desktop" aria-label="Navigation principale">
      <a href="/" class={currentPage === "index" ? "active" : ""} aria-current={currentPage === "index" ? "page" : undefined}>Accueil</a>
      <a href="/services" class={currentPage === "services" ? "active" : ""} aria-current={currentPage === "services" ? "page" : undefined}>Services</a>
      <a href="/a-propos" class={currentPage === "a-propos" ? "active" : ""} aria-current={currentPage === "a-propos" ? "page" : undefined}>Qui nous sommes</a>
      <a href="/contact" class={currentPage === "contact" ? "active" : ""} aria-current={currentPage === "contact" ? "page" : undefined}>Contact</a>
    </nav>
    
    <!-- Bouton Hamburger Mobile -->
    <button 
      class="nav-toggle" 
      type="button" 
      id="nav-toggle-btn"
      aria-label="Ouvrir le menu de navigation" 
      aria-expanded="false"
      aria-controls="nav-menu-mobile">
      <span class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>
  </div>
  
  <!-- Overlay Mobile -->
  <div class="menu-overlay" id="menu-overlay" aria-hidden="true"></div>
  
  <!-- Menu Mobile Slide-out - SIMPLIFIÉ -->
  <nav class="nav-links-mobile" id="nav-menu-mobile" aria-label="Navigation mobile" role="navigation">
    <div class="mobile-menu-header">
      <span class="mobile-menu-title">Menu</span>
      <button 
        class="mobile-menu-close" 
        id="mobile-menu-close"
        aria-label="Fermer"
        type="button">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="mobile-menu-links">
      <a href="/" class={currentPage === "index" ? "active" : ""}>Accueil</a>
      <a href="/services" class={currentPage === "services" ? "active" : ""}>Services</a>
      <a href="/contact" class={currentPage === "contact" ? "active" : ""}>Contact</a>
    </div>
  </nav>
</header>

<script is:inline>
/**
 * Menu Navigation Mobile - ECOFUNDRIVE
 * JavaScript inline pour éviter les fichiers externes
 */
(function() {
  'use strict';
  
  function initMenu() {
    const navToggle = document.getElementById('nav-toggle-btn');
    const navMenu = document.getElementById('nav-menu-mobile');
    const menuOverlay = document.getElementById('menu-overlay');
    const menuClose = document.getElementById('mobile-menu-close');
    const body = document.body;
    
    if (!navToggle || !navMenu) return;
    
    function openMenu() {
      navMenu.classList.add('open');
      if (menuOverlay) {
        menuOverlay.classList.add('active');
        menuOverlay.setAttribute('aria-hidden', 'false');
      }
      navToggle.setAttribute('aria-expanded', 'true');
      navToggle.classList.add('active');
      body.classList.add('menu-open');
    }
    
    function closeMenu() {
      navMenu.classList.remove('open');
      if (menuOverlay) {
        menuOverlay.classList.remove('active');
        menuOverlay.setAttribute('aria-hidden', 'true');
      }
      navToggle.setAttribute('aria-expanded', 'false');
      navToggle.classList.remove('active');
      body.classList.remove('menu-open');
    }
    
    function toggleMenu() {
      if (navMenu.classList.contains('open')) {
        closeMenu();
      } else {
        openMenu();
      }
    }
    
    if (navToggle) {
      navToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();
        toggleMenu();
      });
      navToggle.addEventListener('touchend', (e) => {
        e.stopPropagation();
        e.preventDefault();
        toggleMenu();
      });
    }
    
    if (menuClose) {
      menuClose.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();
        closeMenu();
      });
      menuClose.addEventListener('touchend', (e) => {
        e.stopPropagation();
        e.preventDefault();
        closeMenu();
      });
    }
    
    if (menuOverlay) {
      menuOverlay.addEventListener('click', (e) => {
        if (e.target === menuOverlay) {
          closeMenu();
        }
      });
      menuOverlay.addEventListener('touchend', (e) => {
        if (e.target === menuOverlay) {
          closeMenu();
        }
      });
    }
    
    const navLinks = navMenu.querySelectorAll('.mobile-menu-links a');
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        setTimeout(() => closeMenu(), 100);
      });
      link.addEventListener('touchend', () => {
        setTimeout(() => closeMenu(), 100);
      });
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navMenu.classList.contains('open')) {
        closeMenu();
      }
    });
    
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768 && navMenu.classList.contains('open')) {
        closeMenu();
      }
    });
    
    navMenu.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  }
  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initMenu);
  } else {
    initMenu();
  }
})();
</script>

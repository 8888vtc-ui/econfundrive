---
import Logo from './Logo.astro';

interface Props {
  currentPage?: string;
}

const { currentPage = "" } = Astro.props;
---

<header class="site-header">
  <div class="container navbar">
    <div class="nav-brand">
      <a href="/" class="nav-brand-link" aria-label="ECOFUNDRIVE - Retour à l'accueil">
        <Logo />
      </a>
    </div>
    
    <button 
      class="nav-toggle" 
      type="button" 
      id="nav-toggle-btn"
      aria-label="Ouvrir le menu de navigation" 
      aria-expanded="false"
      aria-controls="nav-menu">
      <span class="hamburger-icon">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>
    
    <div class="menu-overlay" id="menu-overlay" aria-hidden="true"></div>
    
    <nav class="nav-links" id="nav-menu" aria-label="Navigation principale" role="navigation">
      <a href="/" class={currentPage === "index" ? "active" : ""} aria-current={currentPage === "index" ? "page" : undefined}>Accueil</a>
      <a href="/services" class={currentPage === "services" ? "active" : ""} aria-current={currentPage === "services" ? "page" : undefined}>Services</a>
      <a href="/a-propos" class={currentPage === "a-propos" ? "active" : ""} aria-current={currentPage === "a-propos" ? "page" : undefined}>Qui nous sommes</a>
      <a href="/contact" class={currentPage === "contact" ? "active" : ""} aria-current={currentPage === "contact" ? "page" : undefined}>Contact</a>
      <a class="btn-primary-mobile" href="/reservation">Réserver maintenant</a>
    </nav>
    
    <a class="btn-primary" href="/reservation" aria-label="Réserver un trajet VTC">Réserver maintenant</a>
  </div>
</header>

<script>
  (function() {
    'use strict';
    
    const navToggle = document.getElementById('nav-toggle-btn');
    const navMenu = document.getElementById('nav-menu');
    const menuOverlay = document.getElementById('menu-overlay');
    const body = document.body;
    
    if (!navToggle || !navMenu) return;
    
    function openMenu() {
      navMenu.classList.add('open');
      menuOverlay?.classList.add('active');
      menuOverlay?.setAttribute('aria-hidden', 'false');
      navToggle.setAttribute('aria-expanded', 'true');
      navToggle.classList.add('active');
      body.style.overflow = 'hidden';
    }
    
    function closeMenu() {
      navMenu.classList.remove('open');
      menuOverlay?.classList.remove('active');
      menuOverlay?.setAttribute('aria-hidden', 'true');
      navToggle.setAttribute('aria-expanded', 'false');
      navToggle.classList.remove('active');
      body.style.overflow = '';
    }
    
    function toggleMenu() {
      if (navMenu.classList.contains('open')) {
        closeMenu();
      } else {
        openMenu();
      }
    }
    
    // Toggle au clic sur le bouton
    navToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });
    
    // Fermer au clic sur l'overlay
    if (menuOverlay) {
      menuOverlay.addEventListener('click', closeMenu);
    }
    
    // Fermer au clic sur un lien
    const navLinks = navMenu.querySelectorAll('a');
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        closeMenu();
      });
    });
    
    // Fermer avec Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && navMenu.classList.contains('open')) {
        closeMenu();
      }
    });
    
    // Fermer au resize si on passe en desktop
    window.addEventListener('resize', () => {
      if (window.innerWidth > 768 && navMenu.classList.contains('open')) {
        closeMenu();
      }
    });
  })();
</script>
